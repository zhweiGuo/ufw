Origin: r860
Description: doc/ufw-framework.8: add note about libvirt
Bug-Ubuntu: https://launchpad.net/bugs/573461

Index: ufw-0.34~rc/doc/ufw-framework.8
===================================================================
--- ufw-0.34~rc.orig/doc/ufw-framework.8	2014-05-16 15:04:17.000000000 -0500
+++ ufw-0.34~rc/doc/ufw-framework.8	2014-05-16 15:05:03.215047225 -0500
@@ -1,4 +1,4 @@
-.TH "UFW FRAMEWORK" "8" "" "October 2011" "October 2011"
+.TH "UFW FRAMEWORK" "8" "" "April 2014" "April 2014"
 
 .SH NAME
 ufw\-framework \- using the ufw framework
@@ -238,6 +238,27 @@
  ufw route allow in on eth0 to 10.0.0.2 port 80 proto tcp
  ufw allow in on eth1 from 10.0.0.100 to any port 22 proto tcp
 
+.SH NOTES
+.PP
+When using ufw with libvirt and bridging, packets may be blocked. The
+libvirt team recommends that the following sysctl's be set to disable netfilter
+on the bridge:
+
+  net.bridge.bridge-nf-call-ip6tables = 0
+  net.bridge.bridge-nf-call-iptables = 0
+  net.bridge.bridge-nf-call-arptables = 0
+
+Note that the bridge module must be loaded in to the kernel before these values
+are set. One way to ensure this works properly with ufw is to add 'bridge' to
+IPT_MODULES in #CONFIG_PREFIX#/default/ufw, and then add the above rules to
+#CONFIG_PREFIX#/ufw/sysctl.conf.
+
+Alternatively to disabling netfilter on the bridge, you can configure iptables
+to allow all traffic to be forwarded across the bridge. Eg, add to
+#CONFIG_PREFIX#/ufw/before.rules within the *filter section:
+
+  -I FORWARD -m physdev --physdev-is-bridged -j ACCEPT
+
 .SH SEE ALSO
 .PP
 \fBufw\fR(8), \fBiptables\fR(8), \fBip6tables\fR(8), \fBiptables\-restore\fR(8), \fBip6tables\-restore\fR(8), \fBsysctl\fR(8), \fBsysctl.conf\fR(5)
